<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>ChatEST</title>

		<!-- bootstrap 5 -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
		/>

		<!-- style -->
		<link rel="stylesheet" href="/static/style.css" />
		<link rel="stylesheet" href="/static/scrollbar.css" />

		<!-- icon -->
		<link rel="icon" href="/static/assets/logo/openai-logo.png" />
	</head>

	<body>
		<div class="d-flex align-items-end position-relative">
			<div
				class="d-flex flex-column justify-content-around align-content-around m-0 vw-100"
			>
				<h2 class="fw-bold text-white p-3">ChatEST</h2>

				<!-- Body -->
				<div class="container mw-100" id="chat-container"></div>
				<!-- end body -->

				<div class="pre-footer">d</div>

				<!-- footer -->
				<footer class="position-relative p-0 h-100">
					<form method="POST" action="">
						<div
							class="position-fixed input-field bottom-0 start-0 text-center bg-dark w-100"
						>
							<div
								class="flex-column justify-content-center align-items-center px-5 pb-4 pt-2"
							>
								<div
									class="input-group rounded-3 row d-flex align-items-center"
								>
									<div class="col-11">{{form.prompt}}</div>
									<button
										class="send-btn ms-1 pe-2 me-1 col"
										id="addon-wrapping send-btn"
										type="submit"
										onclick="sendPrompt()"
									>
										<i class="far fa-paper-plane"></i>
									</button>
								</div>

								<div class="text-muted">
									<a
										href="https://github.com/HCMUS-Project/Chatbox"
										class="text-muted"
										>ChatEST source</a
									>
									Free Research Preview. ChatEST is not for commercial
									use.
								</div>
							</div>
							<button class="btn btn-warning" onclick="clearChat()">
								<i class="fas fa-trash-alt"></i>
								<span class="ps-2">Clear chat</span>
							</button>
						</div>
					</form>
				</footer>
				<!-- end footer -->
			</div>
		</div>
	</body>

	<script
		src="https://kit.fontawesome.com/c67e626608.js"
		crossorigin="anonymous"
	></script>

	<script>
		window.onload = function () {
			document.getElementById("prompt").value = "";

			addBot();
		};

		function addBot() {
			console.log("-------- ADD BOT ----------");
			// alert("addBot");

			const chatContainer = document.getElementById("chat-container");
			chatContainer.innerHTML = localStorage.getItem("Chat");

			console.log(
				"localStorage.getItem('Chat')",
				localStorage.getItem("Chat"),
			);

			let message = "{{message}}";

			if (message != "") {
				const botMsg =
					`<div class="chat-gpt-prompt row px-5 py-4 bg-light-dark gap-3">
							<img
								class="col-1 p-0 img-thumbnail bg-transparent border-0 align-content-end"
								src="/static/assets/logo/ChatGPT_logo.png"
								alt="chatGPT_logo"
							/>
							<p class="content col-11">` +
					message +
					`	</p>
						</div>
					`;

				chatContainer.innerHTML += botMsg;

				localStorage.setItem("Chat", chatContainer.innerHTML);
				window.scrollTo(
					0,
					document.body.scrollHeight ||
						document.documentElement.scrollHeight,
				);
			}
			console.log("-------- END ADD BOT ----------");
		}

		function sendPrompt() {
			console.log("-------- SEND PROMPT ----------");
			prompt = document.getElementById("prompt").value;
			console.log("prompt" + prompt);

			if (prompt.replace(" ", "") == "") return;

			const chatContainer = document.getElementById("chat-container");
			chatContainer.innerHTML = localStorage.getItem("Chat");

			const userPrompt =
				`<div class="user-prompt row px-5 py-4 gap-3">
						<img
							class="col-1 p-0 img-thumbnail bg-transparent border-0"
							src="/static/assets/logo/User_logo.jpg"
							alt="User_logo"
						/>
						<p class="content col-11">` +
				prompt +
				`	</p>
					</div>
				`;

			chatContainer.innerHTML += userPrompt;

			localStorage.setItem("Chat", chatContainer.innerHTML);
			console.log("-------- END SEND PROMPT ----------");

			window.scrollTo(
				0,
				document.body.scrollHeight || document.documentElement.scrollHeight,
			);
		}

		function clearChat() {
			// alert("clear chat");
			document.getElementById("prompt").value = "";
			window.localStorage.clear();
			window.location.reload();
		}
	</script>
</html>
